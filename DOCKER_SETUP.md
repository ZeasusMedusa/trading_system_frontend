# üê≥ Docker Setup Guide

–ó–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ + –±—ç–∫–µ–Ω–¥ + –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö) –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π.

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **Docker** –∏ **Docker Compose** —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
2. **–ë—ç–∫–µ–Ω–¥ –ø—Ä–æ–µ–∫—Ç** –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ä—è–¥–æ–º —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º (–≤ `../smiio-backend/`)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã

```bash
docker-compose up -d
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å

```bash
docker-compose ps
```

### 3. –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ

- **Frontend**: http://localhost:3000
- **Backend API**: http://localhost:8000
- **API Docs**: http://localhost:8000/docs

### 4. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã

```bash
docker-compose down
```

### 5. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ

```bash
docker-compose down -v
```

## üì¶ –°–µ—Ä–≤–∏—Å—ã

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|----------|
| `frontend` | 3000 | Next.js —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ |
| `backend` | 8000 | FastAPI –±—ç–∫–µ–Ω–¥ |
| `postgres` | 5432 | PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö |
| `redis` | 6379 | Redis –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π |

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env.local` –¥–ª—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π:

```env
# API
NEXT_PUBLIC_API_URL=http://localhost:8000

# Database (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å)
DATABASE_URL=postgresql://smiio_user:smiio_password@postgres:5432/smiio_backtest

# Redis
REDIS_URL=redis://redis:6379/0
```

### –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç—ã

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `docker-compose.yml`:

```yaml
services:
  frontend:
    ports:
      - "3001:3000"  # –ò–∑–º–µ–Ω–∏—Ç–µ 3001 –Ω–∞ –Ω—É–∂–Ω—ã–π –ø–æ—Ä—Ç
```

## üìù –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose logs -f

# –¢–æ–ª—å–∫–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
docker-compose logs -f frontend

# –¢–æ–ª—å–∫–æ –±—ç–∫–µ–Ω–¥
docker-compose logs -f backend
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å

```bash
docker-compose restart frontend
docker-compose restart backend
```

### –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã

```bash
docker-compose build
docker-compose up -d --build
```

### –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

```bash
# Bash –≤ –±—ç–∫–µ–Ω–¥–µ
docker-compose exec backend bash

# Bash –≤–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
docker-compose exec frontend sh
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –±—ç–∫–µ–Ω–¥–µ
docker-compose exec backend alembic upgrade head
```

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### Development mode (—Å hot-reload)

Docker-compose —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è dev —Ä–µ–∂–∏–º–∞:
- Frontend: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `npm run dev`
- Backend: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `--reload` —Ñ–ª–∞–≥

–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è!

### Production build

–ò–∑–º–µ–Ω–∏—Ç–µ `docker-compose.yml`:

```yaml
frontend:
  command: npm start  # –í–º–µ—Å—Ç–æ npm run dev
```

–ò –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ:

```bash
docker-compose up -d --build
```

## üêõ Troubleshooting

### –ü–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã

–ï—Å–ª–∏ –ø–æ—Ä—Ç 3000/8000 –∑–∞–Ω—è—Ç, –∏–∑–º–µ–Ω–∏—Ç–µ –≤ `docker-compose.yml`:

```yaml
ports:
  - "3001:3000"  # –§—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ 3001
  - "8001:8000"  # –ë—ç–∫–µ–Ω–¥ –Ω–∞ 8001
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è

```bash
# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É
docker-compose down -v
docker-compose up -d postgres
# –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–ø—É—Å–∫–∞ –∏ –∑–∞—Ç–µ–º:
docker-compose up -d
```

### –ù–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `NEXT_PUBLIC_API_URL` –≤ `.env.local`:
- –î–ª—è Docker: `http://localhost:8000`
- –î–ª—è ngrok: `https://your-ngrok-url.ngrok-free.app`

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

```bash
docker stats
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å healthcheck

```bash
docker-compose ps
```

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å `healthy`.

## üîí Production

–î–ª—è production –æ–∫—Ä—É–∂–µ–Ω–∏—è:

1. **–ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏** –≤ `docker-compose.yml`
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã** –≤–º–µ—Å—Ç–æ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ nginx** –∫–∞–∫ reverse proxy
4. **–í–∫–ª—é—á–∏—Ç–µ HTTPS**
5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ volume** –¥–ª—è static —Ñ–∞–π–ª–æ–≤

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- Backend Dockerfile –¥–æ–ª–∂–µ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ `../smiio-backend/Dockerfile`
- –°—Ö–µ–º–∞ –ë–î –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∏–∑ `supabase/schema.sql`
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Docker volumes –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏

