# DEVELOPMENT GUIDELINES - ОБЯЗАТЕЛЬНО К ИСПОЛНЕНИЮ

## ⚠️ КРИТИЧЕСКИ ВАЖНЫЕ ПРАВИЛА

### 1. НИКОГДА НЕ ПРИНИМАТЬ САМОСТОЯТЕЛЬНЫХ РЕШЕНИЙ

❌ **ЗАПРЕЩЕНО:**
- Выдумывать решения самостоятельно
- Добавлять функционал без явного запроса
- Удалять функционал без явного разрешения
- Менять логику работы "для улучшения"
- Рефакторить код без запроса
- Добавлять "оптимизации" без согласования

✅ **ОБЯЗАТЕЛЬНО:**
- Делать ТОЛЬКО то, что явно попросили
- Спрашивать, если что-то не ясно
- Уточнять перед любыми изменениями
- Получать подтверждение на все решения

### 2. ВСЕГДА ЗАДАВАТЬ ВОПРОСЫ

Если не уверен - **СПРОСИ**:
- "Правильно ли я понял, что нужно сделать X?"
- "Вы хотите, чтобы я удалил Y или оставил?"
- "Как обработать ситуацию Z?"
- "Нужно ли сохранить существующий функционал A?"

❌ **НЕ ДЕЛАЙ:**
- "Я думаю, будет лучше если..."
- "Для исправления бага я также изменю..."
- "Добавлю еще эту функцию для полноты..."

✅ **ДЕЛАЙ:**
- "Уточните, пожалуйста..."
- "Как вы хотите, чтобы это работало?"
- "Нужно ли мне изменить X?"

### 3. ОБЯЗАТЕЛЬНОЕ СОЗДАНИЕ БЕКАПОВ

**ВСЕГДА создавай бекап перед изменением файлов:**

```bash
# Перед изменением файла
cp file.tsx file.tsx.backup-YYYY-MM-DD
```

**Когда создавать бекапы:**
- ✅ Перед любыми изменениями в существующих файлах
- ✅ Перед рефакторингом
- ✅ Перед исправлением багов
- ✅ Перед добавлением нового функционала

**Исключения** (не нужен бекап):
- Новые файлы (их еще нет)
- Файлы документации (.md)

### 4. НЕ ЛОМАТЬ РАБОЧИЙ КОД

❌ **ЗАПРЕЩЕНО:**
- Менять код, который уже работает
- "Улучшать" рабочую логику
- Рефакторить функционал без запроса
- Менять API, которые используются

✅ **ОБЯЗАТЕЛЬНО:**
- Сохранять работающий функционал
- Изменять только проблемные участки
- Тестировать после изменений
- Откатывать, если что-то сломалось

### 5. ТОЧЕЧНОЕ ИСПРАВЛЕНИЕ БАГОВ

**При исправлении бага трогай ТОЛЬКО:**
- ✅ Код, который непосредственно вызывает баг
- ✅ Прямые зависимости этого кода
- ✅ Необходимые импорты/типы

**НЕ трогай:**
- ❌ Несвязанный код "для улучшения"
- ❌ Другие компоненты "на всякий случай"
- ❌ Рабочие функции "для оптимизации"

**Пример:**

❌ **НЕПРАВИЛЬНО:**
```
Баг: кнопка не работает
Действия: 
- Исправил кнопку
- Заодно переписал весь компонент
- Добавил новые фичи
- Изменил стили
- Рефакторнул логику
```

✅ **ПРАВИЛЬНО:**
```
Баг: кнопка не работает
Действия:
- Исправил onClick handler
- Проверил, что работает
- Всё остальное не тронул
```

### 6. КРАСИВЫЙ И АККУРАТНЫЙ КОД

**Требования к коду:**

#### Форматирование
```typescript
// ✅ ХОРОШО
function myFunction(param: string): void {
  if (condition) {
    doSomething();
  }
}

// ❌ ПЛОХО
function myFunction(param: string): void 
{
if(condition){doSomething();}
}
```

#### Именование
```typescript
// ✅ ХОРОШО
const handleUserLogin = async () => { ... }
const isUserAuthenticated = true;
const userProfileData = { ... };

// ❌ ПЛОХО
const f = async () => { ... }
const x = true;
const data = { ... };
```

#### Комментарии
```typescript
// ✅ ХОРОШО
// Load user preferences from localStorage
const preferences = loadPreferences();

// Calculate average PnL over all trades
const avgPnL = totalPnL / trades.length;

// ❌ ПЛОХО
const preferences = loadPreferences(); // load
const avgPnL = totalPnL / trades.length;
```

### 7. РАЗДЕЛЕНИЕ НА ПРОСТЫЕ ФАЙЛЫ

❌ **НЕ создавай:**
- Огромные файлы >500 строк
- "God objects" с множеством функций
- Монолитные компоненты

✅ **СОЗДАВАЙ:**
- Маленькие файлы <300 строк
- Один файл = одна ответственность
- Переиспользуемые модули

**Пример структуры:**

```
components/
├── Button.tsx           (50 строк)
├── Modal.tsx            (100 строк)
├── Table.tsx            (150 строк)
└── Form/
    ├── Input.tsx        (80 строк)
    ├── Select.tsx       (90 строк)
    └── Checkbox.tsx     (60 строк)

utils/
├── formatting.ts        (100 строк)
├── validation.ts        (120 строк)
└── storage.ts           (150 строк)
```

### 8. ПЕРЕИСПОЛЬЗУЕМЫЙ КОД

**Принципы:**

#### DRY (Don't Repeat Yourself)
```typescript
// ❌ ПЛОХО
const user1Name = userData1.firstName + ' ' + userData1.lastName;
const user2Name = userData2.firstName + ' ' + userData2.lastName;
const user3Name = userData3.firstName + ' ' + userData3.lastName;

// ✅ ХОРОШО
const getFullName = (user: User) => `${user.firstName} ${user.lastName}`;
const user1Name = getFullName(userData1);
const user2Name = getFullName(userData2);
const user3Name = getFullName(userData3);
```

#### Общие компоненты
```typescript
// ✅ ХОРОШО - переиспользуемый компонент
function Button({ onClick, children, variant = 'primary' }) {
  return (
    <button 
      onClick={onClick}
      className={getButtonStyles(variant)}
    >
      {children}
    </button>
  );
}

// Использование
<Button variant="primary">Save</Button>
<Button variant="danger">Delete</Button>
<Button variant="secondary">Cancel</Button>
```

#### Общие утилиты
```typescript
// utils/formatting.ts
export const formatDate = (date: string) => { ... }
export const formatCurrency = (amount: number) => { ... }
export const formatPercentage = (value: number) => { ... }

// Импорт где нужно
import { formatDate, formatCurrency } from '@/utils/formatting';
```

### 9. ЛЕГКО МАСШТАБИРУЕМЫЙ КОД

**Архитектурные принципы:**

#### Модульность
```
lib/
├── api/
│   ├── client.ts          - Axios instance
│   ├── config.ts          - Configuration
│   └── endpoints/
│       ├── auth.ts        - Auth endpoints
│       ├── backtest.ts    - Backtest endpoints
│       └── settings.ts    - Settings endpoints
```

#### Расширяемость
```typescript
// ✅ ХОРОШО - легко добавить новые типы
interface Strategy {
  type: 'single' | 'dual' | 'multi'; // можно добавить 'multi'
  execute: () => void;
}

// ❌ ПЛОХО - хардкод
if (strategy === 'single') { ... }
else if (strategy === 'dual') { ... }
// Сложно добавить новый тип
```

#### Конфигурация
```typescript
// ✅ ХОРОШО - централизованная конфигурация
export const CONFIG = {
  API_BASE_URL: 'http://127.0.0.1:8000',
  API_TIMEOUT: 120000,
  MAX_RETRIES: 3,
  STORAGE_KEY: 'saved_strategies',
};

// Использование
axios.create({ baseURL: CONFIG.API_BASE_URL });
```

### 10. ПОРЯДОК ДЕЙСТВИЙ ПРИ ИЗМЕНЕНИЯХ

**Стандартный процесс:**

1. **Понять запрос**
   - Прочитать внимательно
   - Уточнить неясные моменты
   - Подтвердить понимание

2. **Создать бекапы**
   ```bash
   cp file1.tsx file1.tsx.backup
   cp file2.ts file2.ts.backup
   ```

3. **Спланировать изменения**
   - Какие файлы затронуты?
   - Что именно нужно изменить?
   - Какие зависимости есть?

4. **Внести изменения**
   - Точечно и аккуратно
   - Только запрошенное
   - Без дополнительных "улучшений"

5. **Проверить**
   - Запустить линтер
   - Проверить типы
   - Убедиться, что ничего не сломалось

6. **Документировать**
   - Обновить CHANGELOG.md
   - Добавить комментарии если нужно
   - Обновить README если изменилось API

### 11. ПРИМЕРЫ ПРАВИЛЬНОГО ПОДХОДА

#### Пример 1: Запрос на исправление бага

**Запрос:** "Кнопка Download не работает"

❌ **НЕПРАВИЛЬНО:**
```
Действия:
1. Исправил кнопку Download
2. Заодно переписал всю логику скачивания
3. Добавил кеширование
4. Изменил UI
5. Рефакторнул весь компонент
```

✅ **ПРАВИЛЬНО:**
```
Вопросы:
- "Какая именно ошибка возникает?"
- "Для каких файлов не работает?"
- "Хотите ли вы, чтобы я изменил что-то еще?"

Действия:
1. Создал бекап файла
2. Исправил только onClick handler
3. Проверил, что работает
4. Всё остальное не тронул
```

#### Пример 2: Запрос на новую функцию

**Запрос:** "Добавь кнопку Save Strategy"

❌ **НЕПРАВИЛЬНО:**
```
Действия:
1. Добавил кнопку
2. Сделал автосохранение
3. Добавил облачную синхронизацию
4. Создал систему версионирования
5. Добавил экспорт в PDF
```

✅ **ПРАВИЛЬНО:**
```
Вопросы:
- "Где разместить кнопку?"
- "Что именно сохранять?"
- "Куда сохранять (localStorage, server)?"
- "Нужен ли модал для ввода имени?"

Действия:
1. Создал бекап затронутых файлов
2. Добавил ТОЛЬКО кнопку Save Strategy
3. Реализовал ТОЛЬКО запрошенный функционал
4. Ничего лишнего не добавил
```

#### Пример 3: Запрос на рефакторинг

**Запрос:** "Исправь ошибку в функции X"

❌ **НЕПРАВИЛЬНО:**
```
Действия:
1. Исправил ошибку
2. Заодно переименовал функцию
3. Изменил сигнатуру
4. Переписал в другом стиле
5. Разбил на несколько функций
```

✅ **ПРАВИЛЬНО:**
```
Вопросы:
- "Исправить только ошибку или нужен рефакторинг?"
- "Можно ли менять сигнатуру функции?"
- "Есть ли другие места, которые зависят от этой функции?"

Действия:
1. Создал бекап
2. Исправил ТОЛЬКО ошибку
3. Сигнатуру и стиль не тронул
4. Проверил, что ничего не сломалось
```

### 12. РАБОТА С БАГАМИ

**Алгоритм исправления:**

1. **Понять баг**
   - Прочитать сообщение об ошибке
   - Найти место возникновения
   - Понять причину

2. **Спросить о подходе**
   - "Я вижу, что проблема в X. Исправить только X?"
   - "Нужно ли проверить связанный код Y?"
   - "Как вы хотите, чтобы это работало?"

3. **Создать бекап**
   ```bash
   cp problematic_file.ts problematic_file.ts.backup-bug-fix
   ```

4. **Исправить точечно**
   - Изменить ТОЛЬКО проблемный код
   - Не трогать рабочие участки
   - Не рефакторить заодно

5. **Проверить**
   - Баг исправлен?
   - Ничего не сломалось?
   - Линтер проходит?

### 13. СТРУКТУРА ФАЙЛОВ

**Максимальные размеры:**
- Компонент: 300 строк
- Утилита: 200 строк
- API модуль: 250 строк
- Тип/интерфейс: 150 строк

**Если файл больше - РАЗДЕЛИТЬ:**

```typescript
// ❌ ПЛОХО - один файл 800 строк
// components/Dashboard.tsx

// ✅ ХОРОШО - разделено на модули
components/
├── Dashboard.tsx           (100 строк)
├── DashboardHeader.tsx     (80 строк)
├── DashboardFilters.tsx    (120 строк)
├── DashboardGrid.tsx       (150 строк)
└── DashboardCard.tsx       (100 строк)
```

### 14. КОД-РЕВЬЮ CHECKLIST

Перед отправкой кода проверь:

- [ ] Сделал ТОЛЬКО то, что попросили?
- [ ] Создал бекапы измененных файлов?
- [ ] Не сломал рабочий функционал?
- [ ] Не добавил ничего лишнего?
- [ ] Код чистый и аккуратный?
- [ ] Файлы не слишком большие?
- [ ] Переиспользуемые компоненты выделены?
- [ ] Нет дублирования кода?
- [ ] Линтер проходит без ошибок?
- [ ] Типы правильные?
- [ ] Комментарии понятные?
- [ ] Документация обновлена?

### 15. КОММУНИКАЦИЯ

**Формат ответов:**

✅ **ХОРОШО:**
```
Понял! Вы хотите, чтобы я:
1. Сделал X
2. Изменил Y
3. Убрал Z

Правильно ли я понял? Можно приступать?
```

❌ **ПЛОХО:**
```
Хорошо, сделаю X, а также улучшу Y и добавлю Z 
для полноты решения.
```

**Перед началом работы:**
- Подтверди понимание задачи
- Уточни неясные моменты
- Получи разрешение на изменения

**Во время работы:**
- Сообщай о проблемах сразу
- Не принимай решений самостоятельно
- Спрашивай при любых сомнениях

**После завершения:**
- Сообщи, что сделано
- Покажи результат
- Спроси, нужно ли что-то еще

### 16. ОСОБЫЕ СЛУЧАИ

#### Конфликтующие требования
**Ситуация:** Новое требование конфликтует со старым

✅ **ПРАВИЛЬНО:**
```
"Новое требование X конфликтует с ранее реализованным Y.
Как вы хотите поступить:
1. Заменить Y на X?
2. Сохранить оба?
3. Сделать опциональным?"
```

#### Неоптимальное решение
**Ситуация:** Запрошенное решение неоптимально

✅ **ПРАВИЛЬНО:**
```
"Я могу реализовать X как вы просите, но это может 
вызвать проблему Y. Вы уверены, что хотите именно X?
Или рассмотрим альтернативу Z?"
```

❌ **НЕПРАВИЛЬНО:**
```
"Вместо X я сделал Z, потому что это лучше"
```

#### Технические ограничения
**Ситуация:** Запрошенное невозможно реализовать

✅ **ПРАВИЛЬНО:**
```
"К сожалению, X невозможно реализовать из-за Y.
Могу предложить альтернативу Z. Как вы хотите поступить?"
```

### 17. РАБОТА С ЗАВИСИМОСТЯМИ

**При изменении функции:**

1. **Найди все использования**
   ```bash
   grep -r "functionName" ./
   ```

2. **Спроси о каждом**
   ```
   "Функция используется в 5 местах:
   - file1.tsx
   - file2.tsx
   - file3.tsx
   
   Изменить везде или только в file1.tsx?"
   ```

3. **Обнови только согласованные места**

### 18. ТЕСТИРОВАНИЕ

**После ЛЮБЫХ изменений:**

1. Запусти линтер
   ```bash
   npm run lint
   ```

2. Проверь типы
   ```bash
   npm run type-check
   ```

3. Проверь в браузере
   - Открой страницу
   - Проверь функционал
   - Проверь консоль на ошибки

4. Проверь затронутые компоненты
   - Протестируй измененные функции
   - Убедись, что связанный код работает

### 19. ДОКУМЕНТАЦИЯ

**ВСЕГДА обновляй:**

- [ ] CHANGELOG.md - при любых изменениях
- [ ] README.md - если изменилось API
- [ ] Технические MD файлы - при новых системах
- [ ] Комментарии в коде - сложная логика

**Формат документации:**
```markdown
## Изменение от YYYY-MM-DD

### Что изменено
- Список изменений

### Причина
- Почему это было сделано

### Затронутые файлы
- file1.tsx
- file2.ts

### Как использовать
- Инструкции для пользователей
```

### 20. ПРИМЕРЫ ИЗ ПРАКТИКИ

#### Случай 1: Превышение квоты localStorage

❌ **ЧТО БЫЛО СДЕЛАНО НЕПРАВИЛЬНО:**
```
Проблема: "Storage quota exceeded"

Действия:
- Придумал многоуровневую систему сжатия
- Добавил автоочистку
- Создал fallback стратегии
- Изменил формат хранения
- Добавил IndexedDB
- Все без согласования
```

✅ **ЧТО НУЖНО БЫЛО СДЕЛАТЬ:**
```
Проблема: "Storage quota exceeded"

Вопросы:
- "Что именно нужно сохранять из данных?"
- "Можно ли не сохранять bars данные?"
- "Сколько стратегий нужно хранить?"
- "Как вы хотите решить проблему с местом?"

Действия:
- Только то, что скажет пользователь
```

#### Случай 2: Удаление функционала

❌ **ЧТО БЫЛО СДЕЛАНО НЕПРАВИЛЬНО:**
```
- Удалил bars данные "для оптимизации"
- Убрал кнопку "потому что она не нужна"
- Изменил логику "так лучше"
```

✅ **ЧТО НУЖНО БЫЛО СДЕЛАТЬ:**
```
Вопрос:
"Вижу, что bars данные занимают много места.
Как вы хотите поступить:
1. Сохранять только часть?
2. Не сохранять вообще?
3. Хранить отдельно?
4. Другой вариант?"

Действия после ответа:
- Точно то, что сказал пользователь
```

## РЕЗЮМЕ

### ⚠️ ЗОЛОТЫЕ ПРАВИЛА

1. **НЕ ПРИНИМАЙ САМОСТОЯТЕЛЬНЫХ РЕШЕНИЙ**
2. **ВСЕГДА СПРАШИВАЙ ПРИ СОМНЕНИЯХ**
3. **СОЗДАВАЙ БЕКАПЫ ПЕРЕД ИЗМЕНЕНИЯМИ**
4. **НЕ ЛОМАЙ РАБОЧИЙ КОД**
5. **ИСПРАВЛЯЙ БАГИ ТОЧЕЧНО**
6. **ПИШИ КРАСИВЫЙ КОД**
7. **РАЗДЕЛЯЙ НА ПРОСТЫЕ ФАЙЛЫ**
8. **СОЗДАВАЙ ПЕРЕИСПОЛЬЗУЕМЫЙ КОД**
9. **ДЕЛАЙ МАСШТАБИРУЕМУЮ АРХИТЕКТУРУ**
10. **ОБНОВЛЯЙ ДОКУМЕНТАЦИЮ**

### 🎯 ГЛАВНЫЙ ПРИНЦИП

**ДЕЛАЙ ТОЛЬКО ТО, ЧТО ПРОСЯТ.**
**СПРАШИВАЙ ОБО ВСЁМ ОСТАЛЬНОМ.**

---

**Эти правила ОБЯЗАТЕЛЬНЫ к исполнению.**
**Любое отклонение - нарушение.**
**При любых сомнениях - СПРАШИВАЙ.**

---

*Документ создан: 2025-10-07*
*Версия: 1.0*
*Статус: ОБЯЗАТЕЛЬНЫЙ К ИСПОЛНЕНИЮ*

